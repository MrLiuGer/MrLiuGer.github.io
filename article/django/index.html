<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          django知识相关 - MrLiu | Blog
        
    </title>

    <link rel="canonical" href="https://mrliuger.github.io/article/django/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/css/beantech.min.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('/img/article_header/article_header.png')
            /*post*/
        
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#django" title="django">django</a>
                            
                        </div>
                        <h1>django知识相关</h1>
                        <h2 class="subheading">Django是一个开放源代码的Web应用框架，由Python写成。采用了MVC的框架模式，即模型M，视图V和控制器C。</h2>
                        <span class="meta">
                            Posted by MrLiu on
                            2017-03-04
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">MrLiu</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">我的主页</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/about/">关于我的</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">我的档案</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">我的标签</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1 id="django-开始">Django 开始</h1>
<h2 id="django的mtv分别代表">Django的MTV分别代表：</h2>
<ol>
<li>Model（模型）：和数据库相关的，负责业务对象与数据库的对象（ORM）</li>
<li>Template（模板）：放所有的html文件模板语法：目的是将变量（数据库的内容）如何巧妙的嵌入到html页面中</li>
<li>View（视图）：负责业务逻辑，并在适当的时候调用Model和Template<br>
<img src="/img/avatar/django1.png" alt="Django文件展开" title="django展开"></li>
</ol>
<h2 id="启动django项目">启动Django项目</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver  <span class="number">8080</span></span><br></pre></td></tr></table></figure>
<h2 id="建表命令">建表命令</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>
<h2 id="路由系统">路由系统</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">         url(正则表达式, views视图函数，参数，别名),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="路由分发">路由分发</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r'^web/'</span>,include(<span class="string">'web.urls'</span>)),</span><br></pre></td></tr></table></figure>
<h2 id="反向生成url">反向生成url</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">函数中</span><br><span class="line">v = reverse(<span class="string">'app名称:别名'</span>, kwargs=&#123;<span class="string">'xx'</span>:xx&#125;)</span><br><span class="line">模板中</span><br><span class="line">&#123;% url <span class="string">'app名称:别名'</span> xx=xx %&#125;</span><br></pre></td></tr></table></figure>
<h2 id="模版语言">模版语言</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;变量&#125;&#125;</span><br><span class="line">&#123;% for item in item_list %&#125;  &lt;a&gt;&#123;&#123; item &#125;&#125;&lt;/a&gt;  &#123;% endfor %&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> ordered_warranty %&#125;  &#123;% <span class="keyword">else</span> %&#125; &#123;% endif %&#125;</span><br><span class="line">母板：&#123;% block title %&#125;&#123;% endblock %&#125;</span><br><span class="line">子板：&#123;% extends <span class="string">"base.html"</span> %&#125;</span><br><span class="line">&#123;&#123; item.event_start|date:<span class="string">"Y-m-d H:i:s"</span>&#125;&#125;</span><br><span class="line">&#123;&#123; bio|truncatewords:<span class="string">"30"</span> &#125;&#125;</span><br><span class="line">&#123;&#123; my_list|first|upper &#125;&#125;</span><br><span class="line">&#123;&#123; name|lower &#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="simple_tag">simple_tag</h2>
<ol>
<li>在app中创建templatetags模块</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> template</span><br><span class="line"><span class="keyword">from</span> django.utils.safestring <span class="keyword">import</span> mark_safe</span><br><span class="line"></span><br><span class="line">register = template.Library()</span><br><span class="line"></span><br><span class="line"><span class="meta">@register.simple_tag</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_simple_time</span><span class="params">(v1,v2,v3)</span>:</span></span><br><span class="line">    <span class="keyword">return</span>  v1 + v2 + v3</span><br><span class="line"></span><br><span class="line"><span class="meta">@register.simple_tag</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_input</span><span class="params">(id,arg)</span>:</span></span><br><span class="line">    result = <span class="string">"&lt;input type='text' id='%s' class='%s' /&gt;"</span> %(id,arg,)</span><br><span class="line">    <span class="keyword">return</span> mark_safe(result)</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>在使用自定义simple_tag的html文件中导入之前创建的 <a href="http://xx.py" target="_blank" rel="noopener">xx.py</a> 文件名</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load xx %&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>使用simple_tag</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% my_simple_time <span class="number">1</span> <span class="number">2</span> <span class="number">3</span>%&#125;</span><br><span class="line">&#123;% my_input <span class="string">'id_username'</span> <span class="string">'hide'</span>%&#125;</span><br></pre></td></tr></table></figure>
<h2 id="中间件">中间件</h2>
<p>在django中，中间件其实就是一个类,在请求到来和结束后，django会根据自己的规则在合适的时机执行中间件中相应的方法<br>
中间件中可以定义四个方法，分别是：</p>
<ul>
<li>process_request(self,request)</li>
<li>process_view(self, request, callback, callback_args, callback_kwargs)</li>
<li>process_template_response(self,request,response)</li>
<li>process_exception(self, request, exception)</li>
<li>process_response(self, request, response)<br>
注册中间件</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE_CLASSES = (</span><br><span class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.common.CommonMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.csrf.CsrfViewMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth.middleware.SessionAuthenticationMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages.middleware.MessageMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><img src="/img%5Cavatar%5Cmiddleware.png" alt="Django中间件" title="django中间件"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">process_request(self,request)　</span><br><span class="line">    <span class="comment">#一般是没有返回值，请求报错：实质上就是中间件resquest返回的错误信息！</span></span><br><span class="line">    <span class="comment">#用于处理request请求，一般没有返回值。若是有return返回值，就不在向下执行，直接通过当前中间件类中的response方法，把结果返回给浏览器。</span></span><br><span class="line">    <span class="comment">#request执行，是在进行路由匹配，执行完之后，已经把所有路由系统中对应的视图函数全部读取。　</span></span><br><span class="line">process_view(self, request, view_func, view_func_args, view_func_kwargs)　</span><br><span class="line">    参数：</span><br><span class="line">        - view_func ----&gt; 视图函数的函数名</span><br><span class="line">        - view_func_args, view_func_kwargs ---&gt;视图函数的参数。</span><br><span class="line">　　<span class="comment">#request请求完了后，返回从头再开始执行第一个view直到最后一个view，</span></span><br><span class="line">　　<span class="comment">#用于处理视图函数，中间件中没有返回执行的视图函数，则会顺序执行到最后一个然后执行视图函数；</span></span><br><span class="line">　　<span class="comment">#如果某个中间件中返回值为直接调用视图函数，则会从当前这个中间件直接跳到视图函数文件去执行视图函数。然后再从response顺序返回(response都会执行)。</span></span><br><span class="line">process_exception(self, request, exception)  <span class="comment">#用于监测错误</span></span><br><span class="line">    - 参数：exception ---&gt; 出错之后，返回给页面的信息，就不再让页面报错！</span><br><span class="line">process_response(self, request, response)</span><br><span class="line">    <span class="comment">#返回给浏览器的响应信息，必须有返回值。    return response</span></span><br><span class="line">    必须有返回值。<span class="keyword">return</span> response</span><br><span class="line">process_template_response(self,request,response)</span><br><span class="line">    <span class="comment">#用于检测 视图函数中返回值，只有返回的是 render 才触发，其他类型不执行。</span></span><br></pre></td></tr></table></figure>
<h2 id="admin">admin</h2>
<p>django amdin是django提供的一个后台管理页面，改管理页面提供完善的html和css，使得你在通过Model创建完数据库表之后，就可以对数据进行增删改查</p>
<ol>
<li>创建后台管理员</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py createsuperuser</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>配置后台管理url</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r'^admin/'</span>, include(admin.site.urls))</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>注册和配置django admin 后台管理页面</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span>  models</span><br><span class="line"></span><br><span class="line">admin.site.register(models.UserType)</span><br><span class="line">admin.site.register(models.UserInfo)</span><br><span class="line">admin.site.register(models.UserGroup)</span><br><span class="line">admin.site.register(models.Asset)</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>设置数据表名称</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserType</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        verbose_name = <span class="string">'用户类型'</span></span><br><span class="line">        verbose_name_plural = <span class="string">'用户类型'</span></span><br></pre></td></tr></table></figure>
<ol start="5">
<li>打开表之后，设定默认显示，需要在model中作如下配置</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserType</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__unicode__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span>  models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfoAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    list_display = (<span class="string">'username'</span>, <span class="string">'password'</span>, <span class="string">'email'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">admin.site.register(models.UserType)</span><br><span class="line">admin.site.register(models.UserInfo,UserInfoAdmin)</span><br><span class="line">admin.site.register(models.UserGroup)</span><br><span class="line">admin.site.register(models.Asset)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span>  models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfoAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    list_display = (<span class="string">'username'</span>, <span class="string">'password'</span>, <span class="string">'email'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">admin.site.register(models.UserType)</span><br><span class="line">admin.site.register(models.UserInfo,UserInfoAdmin)</span><br><span class="line">admin.site.register(models.UserGroup)</span><br><span class="line">admin.site.register(models.Asset)</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>为数据表添加搜索功能</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span>  models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfoAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    list_display = (<span class="string">'username'</span>, <span class="string">'password'</span>, <span class="string">'email'</span>)</span><br><span class="line">    search_fields = (<span class="string">'username'</span>, <span class="string">'email'</span>)</span><br><span class="line"></span><br><span class="line">admin.site.register(models.UserType)</span><br><span class="line">admin.site.register(models.UserInfo,UserInfoAdmin)</span><br><span class="line">admin.site.register(models.UserGroup)</span><br><span class="line">admin.site.register(models.Asset)</span><br></pre></td></tr></table></figure>
<ol start="7">
<li>添加快速过滤</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app01 <span class="keyword">import</span>  models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfoAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    list_display = (<span class="string">'username'</span>, <span class="string">'password'</span>, <span class="string">'email'</span>)</span><br><span class="line">    search_fields = (<span class="string">'username'</span>, <span class="string">'email'</span>)</span><br><span class="line">    list_filter = (<span class="string">'username'</span>, <span class="string">'email'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">admin.site.register(models.UserType)</span><br><span class="line">admin.site.register(models.UserInfo,UserInfoAdmin)</span><br><span class="line">admin.site.register(models.UserGroup)</span><br><span class="line">admin.site.register(models.Asset)</span><br></pre></td></tr></table></figure>
<h2 id="form">Form</h2>
<p>django中的Form一般有两种功能：</p>
<ol>
<li>输入html</li>
<li>验证用户输入</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> ValidationError</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mobile_validate</span><span class="params">(value)</span>:</span></span><br><span class="line">    mobile_re = re.compile(<span class="string">r'^(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]&#123;8&#125;$'</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> mobile_re.match(value):</span><br><span class="line">        <span class="keyword">raise</span> ValidationError(<span class="string">'手机号码格式错误'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PublishForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line"></span><br><span class="line">    user_type_choice = (</span><br><span class="line">        (<span class="number">0</span>, <span class="string">u'普通用户'</span>),</span><br><span class="line">        (<span class="number">1</span>, <span class="string">u'高级用户'</span>),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    user_type = forms.IntegerField(widget=forms.widgets.Select(choices=user_type_choice,</span><br><span class="line">                                                                  attrs=&#123;<span class="string">'class'</span>: <span class="string">"form-control"</span>&#125;))</span><br><span class="line"></span><br><span class="line">    title = forms.CharField(max_length=<span class="number">20</span>,</span><br><span class="line">                            min_length=<span class="number">5</span>,</span><br><span class="line">                            error_messages=&#123;<span class="string">'required'</span>: <span class="string">u'标题不能为空'</span>,</span><br><span class="line">                                            <span class="string">'min_length'</span>: <span class="string">u'标题最少为5个字符'</span>,</span><br><span class="line">                                            <span class="string">'max_length'</span>: <span class="string">u'标题最多为20个字符'</span>&#125;,</span><br><span class="line">                            widget=forms.TextInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">"form-control"</span>,</span><br><span class="line">                                                          <span class="string">'placeholder'</span>: <span class="string">u'标题5-20个字符'</span>&#125;))</span><br><span class="line"></span><br><span class="line">    memo = forms.CharField(required=<span class="keyword">False</span>,</span><br><span class="line">                           max_length=<span class="number">256</span>,</span><br><span class="line">                           widget=forms.widgets.Textarea(attrs=&#123;<span class="string">'class'</span>: <span class="string">"form-control no-radius"</span>, <span class="string">'placeholder'</span>: <span class="string">u'详细描述'</span>, <span class="string">'rows'</span>: <span class="number">3</span>&#125;))</span><br><span class="line"></span><br><span class="line">    phone = forms.CharField(validators=[mobile_validate, ],</span><br><span class="line">                            error_messages=&#123;<span class="string">'required'</span>: <span class="string">u'手机不能为空'</span>&#125;,</span><br><span class="line">                            widget=forms.TextInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">"form-control"</span>,</span><br><span class="line">                                                          <span class="string">'placeholder'</span>: <span class="string">u'手机号码'</span>&#125;))</span><br><span class="line"></span><br><span class="line">    email = forms.EmailField(required=<span class="keyword">False</span>,</span><br><span class="line">                            error_messages=&#123;<span class="string">'required'</span>: <span class="string">u'邮箱不能为空'</span>,<span class="string">'invalid'</span>: <span class="string">u'邮箱格式错误'</span>&#125;,</span><br><span class="line">                            widget=forms.TextInput(attrs=&#123;<span class="string">'class'</span>: <span class="string">"form-control"</span>, <span class="string">'placeholder'</span>: <span class="string">u'邮箱'</span>&#125;))</span><br><span class="line"></span><br><span class="line">Form</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">publish</span><span class="params">(request)</span>:</span></span><br><span class="line">    ret = &#123;<span class="string">'status'</span>: <span class="keyword">False</span>, <span class="string">'data'</span>: <span class="string">''</span>, <span class="string">'error'</span>: <span class="string">''</span>, <span class="string">'summary'</span>: <span class="string">''</span>&#125;</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        request_form = PublishForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> request_form.is_valid():</span><br><span class="line">            request_dict = request_form.clean()</span><br><span class="line">            <span class="keyword">print</span> request_dict</span><br><span class="line">            ret[<span class="string">'status'</span>] = <span class="keyword">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            error_msg = request_form.errors.as_json()</span><br><span class="line">            ret[<span class="string">'error'</span>] = json.loads(error_msg)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(json.dumps(ret))</span><br><span class="line"></span><br><span class="line">View</span><br></pre></td></tr></table></figure>
<p>Form上传文件实例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileForm</span><span class="params">(forms.Form)</span>:</span></span><br><span class="line">    ExcelFile = forms.FileField()</span><br><span class="line">form</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UploadFile</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    userid = models.CharField(max_length = <span class="number">30</span>)</span><br><span class="line">    file = models.FileField(upload_to = <span class="string">'./upload/'</span>)</span><br><span class="line">    date = models.DateTimeField(auto_now_add=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">Model</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">UploadFile</span><span class="params">(request)</span>:</span></span><br><span class="line">    uf = AssetForm.FileForm(request.POST,request.FILES)</span><br><span class="line">    <span class="keyword">if</span> uf.is_valid():</span><br><span class="line">            upload = models.UploadFile()</span><br><span class="line">            upload.userid = <span class="number">1</span></span><br><span class="line">            upload.file = uf.cleaned_data[<span class="string">'ExcelFile'</span>]</span><br><span class="line">            upload.save()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">print</span> upload.file</span><br><span class="line"></span><br><span class="line">View</span><br></pre></td></tr></table></figure>
<h3 id="modelform">ModelForm</h3>
<p>在使用Model和Form时，都需要对字段进行定义并指定类型，通过ModelForm则可以省去From中字段的定义</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdminModelForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = models.Admin</span><br><span class="line">        <span class="comment">#fields = '__all__'</span></span><br><span class="line">        fields = (<span class="string">'username'</span>, <span class="string">'email'</span>)</span><br><span class="line"></span><br><span class="line">        widgets = &#123;</span><br><span class="line">            <span class="string">'email'</span> : forms.PasswordInput(attrs=&#123;<span class="string">'class'</span>:<span class="string">"alex"</span>&#125;),</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h2 id="orm数据库操作">ORM数据库操作</h2>
<p>ORM即：关系对象映射（Object Relational Mapping，简称ORM）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">userinfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">30</span>)</span><br><span class="line">    email = models.EmailField()</span><br><span class="line">    memo = models.TextField()</span><br></pre></td></tr></table></figure>
<h3 id="字段">字段</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line">AutoField(Field)</span><br><span class="line">        - int自增列，必须填入参数 primary_key=<span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">    BigAutoField(AutoField)</span><br><span class="line">        - bigint自增列，必须填入参数 primary_key=<span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">        注：当model中如果没有自增列，则自动会创建一个列名为id的列</span><br><span class="line">        <span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">            <span class="comment"># 自动创建一个列名为id的且为自增的整数列</span></span><br><span class="line">            username = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Group</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">            <span class="comment"># 自定义自增列</span></span><br><span class="line">            nid = models.AutoField(primary_key=<span class="keyword">True</span>)</span><br><span class="line">            name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    SmallIntegerField(IntegerField):</span><br><span class="line">        - 小整数 <span class="number">-32768</span> ～ <span class="number">32767</span></span><br><span class="line"></span><br><span class="line">    PositiveSmallIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)</span><br><span class="line">        - 正小整数 <span class="number">0</span> ～ <span class="number">32767</span></span><br><span class="line">    IntegerField(Field)</span><br><span class="line">        - 整数列(有符号的) <span class="number">-2147483648</span> ～ <span class="number">2147483647</span></span><br><span class="line"></span><br><span class="line">    PositiveIntegerField(PositiveIntegerRelDbTypeMixin, IntegerField)</span><br><span class="line">        - 正整数 <span class="number">0</span> ～ <span class="number">2147483647</span></span><br><span class="line"></span><br><span class="line">    BigIntegerField(IntegerField):</span><br><span class="line">        - 长整型(有符号的) <span class="number">-9223372036854775808</span> ～ <span class="number">9223372036854775807</span></span><br><span class="line"></span><br><span class="line">    自定义无符号整数字段</span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">UnsignedIntegerField</span><span class="params">(models.IntegerField)</span>:</span></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">db_type</span><span class="params">(self, connection)</span>:</span></span><br><span class="line">                <span class="keyword">return</span> <span class="string">'integer UNSIGNED'</span></span><br><span class="line"></span><br><span class="line">        PS: 返回值为字段在数据库中的属性，Django字段默认的值为：</span><br><span class="line">            <span class="string">'AutoField'</span>: <span class="string">'integer AUTO_INCREMENT'</span>,</span><br><span class="line">            <span class="string">'BigAutoField'</span>: <span class="string">'bigint AUTO_INCREMENT'</span>,</span><br><span class="line">            <span class="string">'BinaryField'</span>: <span class="string">'longblob'</span>,</span><br><span class="line">            <span class="string">'BooleanField'</span>: <span class="string">'bool'</span>,</span><br><span class="line">            <span class="string">'CharField'</span>: <span class="string">'varchar(%(max_length)s)'</span>,</span><br><span class="line">            <span class="string">'CommaSeparatedIntegerField'</span>: <span class="string">'varchar(%(max_length)s)'</span>,</span><br><span class="line">            <span class="string">'DateField'</span>: <span class="string">'date'</span>,</span><br><span class="line">            <span class="string">'DateTimeField'</span>: <span class="string">'datetime'</span>,</span><br><span class="line">            <span class="string">'DecimalField'</span>: <span class="string">'numeric(%(max_digits)s, %(decimal_places)s)'</span>,</span><br><span class="line">            <span class="string">'DurationField'</span>: <span class="string">'bigint'</span>,</span><br><span class="line">            <span class="string">'FileField'</span>: <span class="string">'varchar(%(max_length)s)'</span>,</span><br><span class="line">            <span class="string">'FilePathField'</span>: <span class="string">'varchar(%(max_length)s)'</span>,</span><br><span class="line">            <span class="string">'FloatField'</span>: <span class="string">'double precision'</span>,</span><br><span class="line">            <span class="string">'IntegerField'</span>: <span class="string">'integer'</span>,</span><br><span class="line">            <span class="string">'BigIntegerField'</span>: <span class="string">'bigint'</span>,</span><br><span class="line">            <span class="string">'IPAddressField'</span>: <span class="string">'char(15)'</span>,</span><br><span class="line">            <span class="string">'GenericIPAddressField'</span>: <span class="string">'char(39)'</span>,</span><br><span class="line">            <span class="string">'NullBooleanField'</span>: <span class="string">'bool'</span>,</span><br><span class="line">            <span class="string">'OneToOneField'</span>: <span class="string">'integer'</span>,</span><br><span class="line">            <span class="string">'PositiveIntegerField'</span>: <span class="string">'integer UNSIGNED'</span>,</span><br><span class="line">            <span class="string">'PositiveSmallIntegerField'</span>: <span class="string">'smallint UNSIGNED'</span>,</span><br><span class="line">            <span class="string">'SlugField'</span>: <span class="string">'varchar(%(max_length)s)'</span>,</span><br><span class="line">            <span class="string">'SmallIntegerField'</span>: <span class="string">'smallint'</span>,</span><br><span class="line">            <span class="string">'TextField'</span>: <span class="string">'longtext'</span>,</span><br><span class="line">            <span class="string">'TimeField'</span>: <span class="string">'time'</span>,</span><br><span class="line">            <span class="string">'UUIDField'</span>: <span class="string">'char(32)'</span>,</span><br><span class="line"></span><br><span class="line">    BooleanField(Field)</span><br><span class="line">        - 布尔值类型</span><br><span class="line"></span><br><span class="line">    NullBooleanField(Field):</span><br><span class="line">        - 可以为空的布尔值</span><br><span class="line"></span><br><span class="line">    CharField(Field)</span><br><span class="line">        - 字符类型</span><br><span class="line">        - 必须提供max_length参数， max_length表示字符长度</span><br><span class="line"></span><br><span class="line">    TextField(Field)</span><br><span class="line">        - 文本类型</span><br><span class="line"></span><br><span class="line">    EmailField(CharField)：</span><br><span class="line">        - 字符串类型，Django Admin以及ModelForm中提供验证机制</span><br><span class="line"></span><br><span class="line">    IPAddressField(Field)</span><br><span class="line">        - 字符串类型，Django Admin以及ModelForm中提供验证 IPV4 机制</span><br><span class="line"></span><br><span class="line">    GenericIPAddressField(Field)</span><br><span class="line">        - 字符串类型，Django Admin以及ModelForm中提供验证 Ipv4和Ipv6</span><br><span class="line">        - 参数：</span><br><span class="line">            protocol，用于指定Ipv4或Ipv6， <span class="string">'both'</span>,<span class="string">"ipv4"</span>,<span class="string">"ipv6"</span></span><br><span class="line">            unpack_ipv4， 如果指定为<span class="keyword">True</span>，则输入::ffff:<span class="number">192.0</span><span class="number">.2</span><span class="number">.1</span>时候，可解析为<span class="number">192.0</span><span class="number">.2</span><span class="number">.1</span>，开启刺功能，需要protocol=<span class="string">"both"</span></span><br><span class="line"></span><br><span class="line">    URLField(CharField)</span><br><span class="line">        - 字符串类型，Django Admin以及ModelForm中提供验证 URL</span><br><span class="line"></span><br><span class="line">    SlugField(CharField)</span><br><span class="line">        - 字符串类型，Django Admin以及ModelForm中提供验证支持 字母、数字、下划线、连接符（减号）</span><br><span class="line"></span><br><span class="line">    CommaSeparatedIntegerField(CharField)</span><br><span class="line">        - 字符串类型，格式必须为逗号分割的数字</span><br><span class="line"></span><br><span class="line">    UUIDField(Field)</span><br><span class="line">        - 字符串类型，Django Admin以及ModelForm中提供对UUID格式的验证</span><br><span class="line"></span><br><span class="line">    FilePathField(Field)</span><br><span class="line">        - 字符串，Django Admin以及ModelForm中提供读取文件夹下文件的功能</span><br><span class="line">        - 参数：</span><br><span class="line">                path,                      文件夹路径</span><br><span class="line">                match=<span class="keyword">None</span>,                正则匹配</span><br><span class="line">                recursive=<span class="keyword">False</span>,           递归下面的文件夹</span><br><span class="line">                allow_files=<span class="keyword">True</span>,          允许文件</span><br><span class="line">                allow_folders=<span class="keyword">False</span>,       允许文件夹</span><br><span class="line"></span><br><span class="line">    FileField(Field)</span><br><span class="line">        - 字符串，路径保存在数据库，文件上传到指定目录</span><br><span class="line">        - 参数：</span><br><span class="line">            upload_to = <span class="string">""</span>      上传文件的保存路径</span><br><span class="line">            storage = <span class="keyword">None</span>      存储组件，默认django.core.files.storage.FileSystemStorage</span><br><span class="line"></span><br><span class="line">    ImageField(FileField)</span><br><span class="line">        - 字符串，路径保存在数据库，文件上传到指定目录</span><br><span class="line">        - 参数：</span><br><span class="line">            upload_to = <span class="string">""</span>      上传文件的保存路径</span><br><span class="line">            storage = <span class="keyword">None</span>      存储组件，默认django.core.files.storage.FileSystemStorage</span><br><span class="line">            width_field=<span class="keyword">None</span>,   上传图片的高度保存的数据库字段名（字符串）</span><br><span class="line">            height_field=<span class="keyword">None</span>   上传图片的宽度保存的数据库字段名（字符串）</span><br><span class="line"></span><br><span class="line">    DateTimeField(DateField)</span><br><span class="line">        - 日期+时间格式 YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ]</span><br><span class="line"></span><br><span class="line">    DateField(DateTimeCheckMixin, Field)</span><br><span class="line">        - 日期格式      YYYY-MM-DD</span><br><span class="line"></span><br><span class="line">    TimeField(DateTimeCheckMixin, Field)</span><br><span class="line">        - 时间格式      HH:MM[:ss[.uuuuuu]]</span><br><span class="line"></span><br><span class="line">    DurationField(Field)</span><br><span class="line">        - 长整数，时间间隔，数据库中按照bigint存储，ORM中获取的值为datetime.timedelta类型</span><br><span class="line"></span><br><span class="line">    FloatField(Field)</span><br><span class="line">        - 浮点型</span><br><span class="line"></span><br><span class="line">    DecimalField(Field)</span><br><span class="line">        - <span class="number">10</span>进制小数</span><br><span class="line">        - 参数：</span><br><span class="line">            max_digits，小数总长度</span><br><span class="line">            decimal_places，小数位长度</span><br><span class="line"></span><br><span class="line">    BinaryField(Field)</span><br><span class="line">        - 二进制类型</span><br></pre></td></tr></table></figure>
<h3 id="参数">参数</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">null                数据库中字段是否可以为空</span><br><span class="line">    db_column           数据库中字段的列名</span><br><span class="line">    db_tablespace</span><br><span class="line">    default             数据库中字段的默认值</span><br><span class="line">    primary_key         数据库中字段是否为主键</span><br><span class="line">    db_index            数据库中字段是否可以建立索引</span><br><span class="line">    unique              数据库中字段是否可以建立唯一索引</span><br><span class="line">    unique_for_date     数据库中字段【日期】部分是否可以建立唯一索引</span><br><span class="line">    unique_for_month    数据库中字段【月】部分是否可以建立唯一索引</span><br><span class="line">    unique_for_year     数据库中字段【年】部分是否可以建立唯一索引</span><br><span class="line"></span><br><span class="line">    verbose_name        Admin中显示的字段名称</span><br><span class="line">    blank               Admin中是否允许用户输入为空</span><br><span class="line">    editable            Admin中是否可以编辑</span><br><span class="line">    help_text           Admin中该字段的提示信息</span><br><span class="line">    choices             Admin中显示选择框的内容，用不变动的数据放在内存中从而避免跨表操作</span><br><span class="line">                        如：gf = models.IntegerField(choices=[(<span class="number">0</span>, <span class="string">'何穗'</span>),(<span class="number">1</span>, <span class="string">'大表姐'</span>),],default=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    error_messages      自定义错误信息（字典类型），从而定制想要显示的错误信息；</span><br><span class="line">                        字典健：null, blank, invalid, invalid_choice, unique, <span class="keyword">and</span> unique_for_date</span><br><span class="line">                        如：&#123;<span class="string">'null'</span>: <span class="string">"不能为空."</span>, <span class="string">'invalid'</span>: <span class="string">'格式错误'</span>&#125;</span><br><span class="line"></span><br><span class="line">    validators          自定义错误验证（列表类型），从而定制想要的验证规则</span><br><span class="line">                        <span class="keyword">from</span> django.core.validators <span class="keyword">import</span> RegexValidator</span><br><span class="line">                        <span class="keyword">from</span> django.core.validators <span class="keyword">import</span> EmailValidator,URLValidator,DecimalValidator,\</span><br><span class="line">                        MaxLengthValidator,MinLengthValidator,MaxValueValidator,MinValueValidator</span><br><span class="line">                        如：</span><br><span class="line">                            test = models.CharField(</span><br><span class="line">                                max_length=<span class="number">32</span>,</span><br><span class="line">                                error_messages=&#123;</span><br><span class="line">                                    <span class="string">'c1'</span>: <span class="string">'优先错信息1'</span>,</span><br><span class="line">                                    <span class="string">'c2'</span>: <span class="string">'优先错信息2'</span>,</span><br><span class="line">                                    <span class="string">'c3'</span>: <span class="string">'优先错信息3'</span>,</span><br><span class="line">                                &#125;,</span><br><span class="line">                                validators=[</span><br><span class="line">                                    RegexValidator(regex=<span class="string">'root_\d+'</span>, message=<span class="string">'错误了'</span>, code=<span class="string">'c1'</span>),</span><br><span class="line">                                    RegexValidator(regex=<span class="string">'root_112233\d+'</span>, message=<span class="string">'又错误了'</span>, code=<span class="string">'c2'</span>),</span><br><span class="line">                                    EmailValidator(message=<span class="string">'又错误了'</span>, code=<span class="string">'c3'</span>), ]</span><br><span class="line">                            )</span><br></pre></td></tr></table></figure>
<h3 id="其他">其他</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">        nid = models.AutoField(primary_key=<span class="keyword">True</span>)</span><br><span class="line">        username = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">            <span class="comment"># 数据库中生成的表名称 默认 app名称 + 下划线 + 类名</span></span><br><span class="line">            db_table = <span class="string">"table_name"</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 联合索引</span></span><br><span class="line">            index_together = [</span><br><span class="line">                (<span class="string">"pub_date"</span>, <span class="string">"deadline"</span>),</span><br><span class="line">            ]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 联合唯一索引</span></span><br><span class="line">            unique_together = ((<span class="string">"driver"</span>, <span class="string">"restaurant"</span>),)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># admin中显示的表名称</span></span><br><span class="line">            verbose_name</span><br><span class="line"></span><br><span class="line">            <span class="comment"># verbose_name加s</span></span><br><span class="line">            verbose_name_plural</span><br><span class="line"></span><br><span class="line">    更多：https://docs.djangoproject.com/en/<span class="number">1.10</span>/ref/models/options/</span><br></pre></td></tr></table></figure>
<h3 id="扩展">扩展</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>触发Model中的验证和错误提示有两种方式：</span><br><span class="line">        a. Django Admin中的错误信息会优先根据Admiin内部的ModelForm错误信息提示，如果都成功，才来检查Model的字段并显示指定错误信息</span><br><span class="line">        b. 调用Model对象的 clean_fields 方法，如：</span><br><span class="line">            <span class="comment"># models.py</span></span><br><span class="line">            <span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">                nid = models.AutoField(primary_key=<span class="keyword">True</span>)</span><br><span class="line">                username = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">                email = models.EmailField(error_messages=&#123;<span class="string">'invalid'</span>: <span class="string">'格式错了.'</span>&#125;)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># views.py</span></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">                obj = models.UserInfo(username=<span class="string">'11234'</span>, email=<span class="string">'uu'</span>)</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    print(obj.clean_fields())</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    print(e)</span><br><span class="line">                <span class="keyword">return</span> HttpResponse(<span class="string">'ok'</span>)</span><br><span class="line"></span><br><span class="line">           <span class="comment"># Model的clean方法是一个钩子，可用于定制操作，如：上述的异常处理。</span></span><br><span class="line"><span class="number">2.</span>Admin中修改错误提示</span><br><span class="line">        <span class="comment"># admin.py</span></span><br><span class="line">        <span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line">        <span class="keyword">from</span> model_club <span class="keyword">import</span> models</span><br><span class="line">        <span class="keyword">from</span> django <span class="keyword">import</span> forms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">UserInfoForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">            username = forms.CharField(error_messages=&#123;<span class="string">'required'</span>: <span class="string">'用户名不能为空.'</span>&#125;)</span><br><span class="line">            email = forms.EmailField(error_messages=&#123;<span class="string">'invalid'</span>: <span class="string">'邮箱格式错误.'</span>&#125;)</span><br><span class="line">            age = forms.IntegerField(initial=<span class="number">1</span>, error_messages=&#123;<span class="string">'required'</span>: <span class="string">'请输入数值.'</span>, <span class="string">'invalid'</span>: <span class="string">'年龄必须为数值.'</span>&#125;)</span><br><span class="line"></span><br><span class="line">            <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">                model = models.UserInfo</span><br><span class="line">                <span class="comment"># fields = ('username',)</span></span><br><span class="line">                fields = <span class="string">"__all__"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">UserInfoAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">            form = UserInfoForm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        admin.site.register(models.UserInfo, UserInfoAdmin)</span><br></pre></td></tr></table></figure>
<h3 id="表结构">表结构</h3>
<ol>
<li>一对多：models.ForeignKey(其他表)</li>
<li>多对多：models.ManyToManyField(其他表)</li>
<li>一对一：models.OneToOneField(其他表)</li>
<li>字段参数</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">ForeignKey(ForeignObject) <span class="comment"># ForeignObject(RelatedField)</span></span><br><span class="line">        to,                         <span class="comment"># 要进行关联的表名</span></span><br><span class="line">        to_field=<span class="keyword">None</span>,              <span class="comment"># 要关联的表中的字段名称</span></span><br><span class="line">        on_delete=<span class="keyword">None</span>,             <span class="comment"># 当删除关联表中的数据时，当前表与其关联的行的行为</span></span><br><span class="line">                                        - models.CASCADE，删除关联数据，与之关联也删除</span><br><span class="line">                                        - models.DO_NOTHING，删除关联数据，引发错误IntegrityError</span><br><span class="line">                                        - models.PROTECT，删除关联数据，引发错误ProtectedError</span><br><span class="line">                                        - models.SET_NULL，删除关联数据，与之关联的值设置为null（前提FK字段需要设置为可空）</span><br><span class="line">                                        - models.SET_DEFAULT，删除关联数据，与之关联的值设置为默认值（前提FK字段需要设置默认值）</span><br><span class="line">                                        - models.SET，删除关联数据，</span><br><span class="line">                                                      a. 与之关联的值设置为指定值，设置：models.SET(值)</span><br><span class="line">                                                      b. 与之关联的值设置为可执行对象的返回值，设置：models.SET(可执行对象)</span><br><span class="line"></span><br><span class="line">                                                        <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">                                                            <span class="keyword">return</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line">                                                        <span class="class"><span class="keyword">class</span> <span class="title">MyModel</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">                                                            user = models.ForeignKey(</span><br><span class="line">                                                                to=<span class="string">"User"</span>,</span><br><span class="line">                                                                to_field=<span class="string">"id"</span></span><br><span class="line">                                                                on_delete=models.SET(func),)</span><br><span class="line">        related_name=<span class="keyword">None</span>,          <span class="comment"># 反向操作时，使用的字段名，用于代替 【表名_set】 如： obj.表名_set.all()</span></span><br><span class="line">        related_query_name=<span class="keyword">None</span>,    <span class="comment"># 反向操作时，使用的连接前缀，用于替换【表名】     如： models.UserGroup.objects.filter(表名__字段名=1).values('表名__字段名')</span></span><br><span class="line">        limit_choices_to=<span class="keyword">None</span>,      <span class="comment"># 在Admin或ModelForm中显示关联数据时，提供的条件：</span></span><br><span class="line">                                    <span class="comment"># 如：</span></span><br><span class="line">                                            - limit_choices_to=&#123;<span class="string">'nid__gt'</span>: <span class="number">5</span>&#125;</span><br><span class="line">                                            - limit_choices_to=<span class="keyword">lambda</span> : &#123;<span class="string">'nid__gt'</span>: <span class="number">5</span>&#125;</span><br><span class="line"></span><br><span class="line">                                            <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line">                                            - limit_choices_to=Q(nid__gt=<span class="number">10</span>)</span><br><span class="line">                                            - limit_choices_to=Q(nid=<span class="number">8</span>) | Q(nid__gt=<span class="number">10</span>)</span><br><span class="line">                                            - limit_choices_to=<span class="keyword">lambda</span> : Q(Q(nid=<span class="number">8</span>) | Q(nid__gt=<span class="number">10</span>)) &amp; Q(caption=<span class="string">'root'</span>)</span><br><span class="line">        db_constraint=<span class="keyword">True</span>          <span class="comment"># 是否在数据库中创建外键约束</span></span><br><span class="line">        parent_link=<span class="keyword">False</span>           <span class="comment"># 在Admin中是否显示关联数据</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    OneToOneField(ForeignKey)</span><br><span class="line">        to,                         <span class="comment"># 要进行关联的表名</span></span><br><span class="line">        to_field=<span class="keyword">None</span>               <span class="comment"># 要关联的表中的字段名称</span></span><br><span class="line">        on_delete=<span class="keyword">None</span>,             <span class="comment"># 当删除关联表中的数据时，当前表与其关联的行的行为</span></span><br><span class="line"></span><br><span class="line">                                    <span class="comment">###### 对于一对一 ######</span></span><br><span class="line">                                    <span class="comment"># 1. 一对一其实就是 一对多 + 唯一索引</span></span><br><span class="line">                                    <span class="comment"># 2.当两个类之间有继承关系时，默认会创建一个一对一字段</span></span><br><span class="line">                                    <span class="comment"># 如下会在A表中额外增加一个c_ptr_id列且唯一：</span></span><br><span class="line">                                            <span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">                                                nid = models.AutoField(primary_key=<span class="keyword">True</span>)</span><br><span class="line">                                                part = models.CharField(max_length=<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line">                                            <span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(C)</span>:</span></span><br><span class="line">                                                id = models.AutoField(primary_key=<span class="keyword">True</span>)</span><br><span class="line">                                                code = models.CharField(max_length=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    ManyToManyField(RelatedField)</span><br><span class="line">        to,                         <span class="comment"># 要进行关联的表名</span></span><br><span class="line">        related_name=<span class="keyword">None</span>,          <span class="comment"># 反向操作时，使用的字段名，用于代替 【表名_set】 如： obj.表名_set.all()</span></span><br><span class="line">        related_query_name=<span class="keyword">None</span>,    <span class="comment"># 反向操作时，使用的连接前缀，用于替换【表名】     如： models.UserGroup.objects.filter(表名__字段名=1).values('表名__字段名')</span></span><br><span class="line">        limit_choices_to=<span class="keyword">None</span>,      <span class="comment"># 在Admin或ModelForm中显示关联数据时，提供的条件：</span></span><br><span class="line">                                    <span class="comment"># 如：</span></span><br><span class="line">                                            - limit_choices_to=&#123;<span class="string">'nid__gt'</span>: <span class="number">5</span>&#125;</span><br><span class="line">                                            - limit_choices_to=<span class="keyword">lambda</span> : &#123;<span class="string">'nid__gt'</span>: <span class="number">5</span>&#125;</span><br><span class="line"></span><br><span class="line">                                            <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line">                                            - limit_choices_to=Q(nid__gt=<span class="number">10</span>)</span><br><span class="line">                                            - limit_choices_to=Q(nid=<span class="number">8</span>) | Q(nid__gt=<span class="number">10</span>)</span><br><span class="line">                                            - limit_choices_to=<span class="keyword">lambda</span> : Q(Q(nid=<span class="number">8</span>) | Q(nid__gt=<span class="number">10</span>)) &amp; Q(caption=<span class="string">'root'</span>)</span><br><span class="line">        symmetrical=<span class="keyword">None</span>,           <span class="comment"># 仅用于多对多自关联时，symmetrical用于指定内部是否创建反向操作的字段</span></span><br><span class="line">                                    <span class="comment"># 做如下操作时，不同的symmetrical会有不同的可选字段</span></span><br><span class="line">                                        models.BB.objects.filter(...)</span><br><span class="line"></span><br><span class="line">                                        <span class="comment"># 可选字段有：code, id, m1</span></span><br><span class="line">                                            <span class="class"><span class="keyword">class</span> <span class="title">BB</span><span class="params">(models.Model)</span>:</span></span><br><span class="line"></span><br><span class="line">                                            code = models.CharField(max_length=<span class="number">12</span>)</span><br><span class="line">                                            m1 = models.ManyToManyField(<span class="string">'self'</span>,symmetrical=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">                                        <span class="comment"># 可选字段有: bb, code, id, m1</span></span><br><span class="line">                                            <span class="class"><span class="keyword">class</span> <span class="title">BB</span><span class="params">(models.Model)</span>:</span></span><br><span class="line"></span><br><span class="line">                                            code = models.CharField(max_length=<span class="number">12</span>)</span><br><span class="line">                                            m1 = models.ManyToManyField(<span class="string">'self'</span>,symmetrical=<span class="keyword">False</span>)</span><br><span class="line"></span><br><span class="line">        through=<span class="keyword">None</span>,               <span class="comment"># 自定义第三张表时，使用字段用于指定关系表</span></span><br><span class="line">        through_fields=<span class="keyword">None</span>,        <span class="comment"># 自定义第三张表时，使用字段用于指定关系表中那些字段做多对多关系表</span></span><br><span class="line">                                        <span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line">                                        <span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">                                            name = models.CharField(max_length=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line">                                        <span class="class"><span class="keyword">class</span> <span class="title">Group</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">                                            name = models.CharField(max_length=<span class="number">128</span>)</span><br><span class="line">                                            members = models.ManyToManyField(</span><br><span class="line">                                                Person,</span><br><span class="line">                                                through=<span class="string">'Membership'</span>,</span><br><span class="line">                                                through_fields=(<span class="string">'group'</span>, <span class="string">'person'</span>),</span><br><span class="line">                                            )</span><br><span class="line"></span><br><span class="line">                                        <span class="class"><span class="keyword">class</span> <span class="title">Membership</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">                                            group = models.ForeignKey(Group, on_delete=models.CASCADE)</span><br><span class="line">                                            person = models.ForeignKey(Person, on_delete=models.CASCADE)</span><br><span class="line">                                            inviter = models.ForeignKey(</span><br><span class="line">                                                Person,</span><br><span class="line">                                                on_delete=models.CASCADE,</span><br><span class="line">                                                related_name=<span class="string">"membership_invites"</span>,</span><br><span class="line">                                            )</span><br><span class="line">                                            invite_reason = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">        db_constraint=<span class="keyword">True</span>,         <span class="comment"># 是否在数据库中创建外键约束</span></span><br><span class="line">        db_table=<span class="keyword">None</span>,              <span class="comment"># 默认创建第三张表时，数据库中表的名称</span></span><br></pre></td></tr></table></figure>
<h3 id="基本操作">基本操作</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 增</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># models.Tb1.objects.create(c1='xx', c2='oo')  增加一条数据，可以接受字典类型数据 **kwargs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># obj = models.Tb1(c1='xx', c2='oo')</span></span><br><span class="line"><span class="comment"># obj.save()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># models.Tb1.objects.get(id=123)         # 获取单条数据，不存在则报错（不建议）</span></span><br><span class="line"><span class="comment"># models.Tb1.objects.all()               # 获取全部</span></span><br><span class="line"><span class="comment"># models.Tb1.objects.filter(name='seven') # 获取指定条件的数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># models.Tb1.objects.filter(name='seven').delete() # 删除指定条件的数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 改</span></span><br><span class="line"><span class="comment"># models.Tb1.objects.filter(name='seven').update(gender='0')  # 将指定条件的数据更新，均支持 **kwargs</span></span><br><span class="line"><span class="comment"># obj = models.Tb1.objects.get(id=1)</span></span><br><span class="line"><span class="comment"># obj.c1 = '111'</span></span><br><span class="line"><span class="comment"># obj.save()                                                 # 修改单条数据</span></span><br></pre></td></tr></table></figure>
<h3 id="进阶操作">进阶操作</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取个数</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(name='seven').count()</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 大于，小于</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(id__gt=1)              # 获取id大于1的值</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(id__gte=1)              # 获取id大于等于1的值</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(id__lt=10)             # 获取id小于10的值</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(id__lte=10)             # 获取id小于10的值</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(id__lt=10, id__gt=1)   # 获取id大于1 且 小于10的值</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># in</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(id__in=[11, 22, 33])   # 获取id等于11、22、33的数据</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.exclude(id__in=[11, 22, 33])  # not in</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># isnull</span></span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__isnull=True)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># contains</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(name__contains="ven")</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(name__icontains="ven") # icontains大小写不敏感</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.exclude(name__icontains="ven")</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># range</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(id__range=[1, 2])   # 范围bettwen and</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 其他类似</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># startswith，istartswith, endswith, iendswith,</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># order by</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(name='seven').order_by('id')    # asc</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(name='seven').order_by('-id')   # desc</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># group by</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># from django.db.models import Count, Min, Max, Sum</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.filter(c1=1).values('id').annotate(c=Count('num'))</span></span><br><span class="line">        <span class="comment"># SELECT "app01_tb1"."id", COUNT("app01_tb1"."num") AS "c" FROM "app01_tb1" WHERE "app01_tb1"."c1" = 1 GROUP BY "app01_tb1"."id"</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># limit 、offset</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># models.Tb1.objects.all()[10:20]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># regex正则匹配，iregex 不区分大小写</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Entry.objects.get(title__regex=r'^(An?|The) +')</span></span><br><span class="line">        <span class="comment"># Entry.objects.get(title__iregex=r'^(an?|the) +')</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># date</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__date=datetime.date(2005, 1, 1))</span></span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__date__gt=datetime.date(2005, 1, 1))</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># year</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__year=2005)</span></span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__year__gte=2005)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># month</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__month=12)</span></span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__month__gte=6)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># day</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__day=3)</span></span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__day__gte=3)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># week_day</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__week_day=2)</span></span><br><span class="line">        <span class="comment"># Entry.objects.filter(pub_date__week_day__gte=2)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># hour</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Event.objects.filter(timestamp__hour=23)</span></span><br><span class="line">        <span class="comment"># Event.objects.filter(time__hour=5)</span></span><br><span class="line">        <span class="comment"># Event.objects.filter(timestamp__hour__gte=12)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># minute</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Event.objects.filter(timestamp__minute=29)</span></span><br><span class="line">        <span class="comment"># Event.objects.filter(time__minute=46)</span></span><br><span class="line">        <span class="comment"># Event.objects.filter(timestamp__minute__gte=29)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># second</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment"># Event.objects.filter(timestamp__second=31)</span></span><br><span class="line">        <span class="comment"># Event.objects.filter(time__second=2)</span></span><br><span class="line">        <span class="comment"># Event.objects.filter(timestamp__second__gte=31)</span></span><br></pre></td></tr></table></figure>
<h3 id="其他操作">其他操作</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># extra</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># extra(self, select=None, where=None, params=None, tables=None, order_by=None, select_params=None)</span></span><br><span class="line">    <span class="comment">#    Entry.objects.extra(select=&#123;'new_id': "select col from sometable where othercol &gt; %s"&#125;, select_params=(1,))</span></span><br><span class="line">    <span class="comment">#    Entry.objects.extra(where=['headline=%s'], params=['Lennon'])</span></span><br><span class="line">    <span class="comment">#    Entry.objects.extra(where=["foo='a' OR bar = 'a'", "baz = 'a'"])</span></span><br><span class="line">    <span class="comment">#    Entry.objects.extra(select=&#123;'new_id': "select id from tb where id &gt; %s"&#125;, select_params=(1,), order_by=['-nid'])</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># F</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># from django.db.models import F</span></span><br><span class="line">    <span class="comment"># models.Tb1.objects.update(num=F('num')+1)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Q</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># 方式一：</span></span><br><span class="line">    <span class="comment"># Q(nid__gt=10)</span></span><br><span class="line">    <span class="comment"># Q(nid=8) | Q(nid__gt=10)</span></span><br><span class="line">    <span class="comment"># Q(Q(nid=8) | Q(nid__gt=10)) &amp; Q(caption='root')</span></span><br><span class="line">    <span class="comment"># 方式二：</span></span><br><span class="line">    <span class="comment"># con = Q()</span></span><br><span class="line">    <span class="comment"># q1 = Q()</span></span><br><span class="line">    <span class="comment"># q1.connector = 'OR'</span></span><br><span class="line">    <span class="comment"># q1.children.append(('id', 1))</span></span><br><span class="line">    <span class="comment"># q1.children.append(('id', 10))</span></span><br><span class="line">    <span class="comment"># q1.children.append(('id', 9))</span></span><br><span class="line">    <span class="comment"># q2 = Q()</span></span><br><span class="line">    <span class="comment"># q2.connector = 'OR'</span></span><br><span class="line">    <span class="comment"># q2.children.append(('c1', 1))</span></span><br><span class="line">    <span class="comment"># q2.children.append(('c1', 10))</span></span><br><span class="line">    <span class="comment"># q2.children.append(('c1', 9))</span></span><br><span class="line">    <span class="comment"># con.add(q1, 'AND')</span></span><br><span class="line">    <span class="comment"># con.add(q2, 'AND')</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># models.Tb1.objects.filter(con)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 执行原生SQL</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># from django.db import connection, connections</span></span><br><span class="line">    <span class="comment"># cursor = connection.cursor()  # cursor = connections['default'].cursor()</span></span><br><span class="line">    <span class="comment"># cursor.execute("""SELECT * from auth_user where id = %s""", [1])</span></span><br><span class="line">    <span class="comment"># row = cursor.fetchone()</span></span><br></pre></td></tr></table></figure>
<h3 id="连表操作">连表操作</h3>
<p>实例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProfile</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    user_info = models.OneToOneField(<span class="string">'UserInfo'</span>)</span><br><span class="line">    username = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">    password = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__unicode__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.username</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    user_type_choice = (</span><br><span class="line">        (<span class="number">0</span>, <span class="string">u'普通用户'</span>),</span><br><span class="line">        (<span class="number">1</span>, <span class="string">u'高级用户'</span>),</span><br><span class="line">    )</span><br><span class="line">    user_type = models.IntegerField(choices=user_type_choice)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    email = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    address = models.CharField(max_length=<span class="number">128</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__unicode__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserGroup</span><span class="params">(models.Model)</span>:</span></span><br><span class="line"></span><br><span class="line">    caption = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">    user_info = models.ManyToManyField(<span class="string">'UserInfo'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__unicode__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.caption</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Host</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    hostname = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">    ip = models.GenericIPAddressField()</span><br><span class="line">    user_group = models.ForeignKey(<span class="string">'UserGroup'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__unicode__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.hostname</span><br></pre></td></tr></table></figure>
<h3 id="一对一">一对一</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">user_info_obj = models.UserInfo.objects.filter(id=<span class="number">1</span>).first()</span><br><span class="line"><span class="keyword">print</span> user_info_obj.user_type</span><br><span class="line"><span class="keyword">print</span> user_info_obj.get_user_type_display()</span><br><span class="line"><span class="keyword">print</span> user_info_obj.userprofile.password</span><br><span class="line"></span><br><span class="line">user_info_obj = models.UserInfo.objects.filter(id=<span class="number">1</span>).values(<span class="string">'email'</span>, <span class="string">'userprofile__username'</span>).first()</span><br><span class="line"><span class="keyword">print</span> user_info_obj.keys()</span><br><span class="line"><span class="keyword">print</span> user_info_obj.values()</span><br></pre></td></tr></table></figure>
<h3 id="一对多">一对多</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 搜索条件使用 __ 连接</span><br><span class="line"><span class="number">2.</span> 获取值时使用 .    连接</span><br></pre></td></tr></table></figure>
<h3 id="多对多">多对多</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">user_info_obj = models.UserInfo.objects.get(name=<span class="string">u'xx'</span>)</span><br><span class="line">user_info_objs = models.UserInfo.objects.all()</span><br><span class="line"></span><br><span class="line">group_obj = models.UserGroup.objects.get(caption=<span class="string">'zz'</span>)</span><br><span class="line">group_objs = models.UserGroup.objects.all()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加数据</span></span><br><span class="line"><span class="comment">#group_obj.user_info.add(user_info_obj)</span></span><br><span class="line"><span class="comment">#group_obj.user_info.add(*user_info_objs)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除数据</span></span><br><span class="line"><span class="comment">#group_obj.user_info.remove(user_info_obj)</span></span><br><span class="line"><span class="comment">#group_obj.user_info.remove(*user_info_objs)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加数据</span></span><br><span class="line"><span class="comment">#user_info_obj.usergroup_set.add(group_obj)</span></span><br><span class="line"><span class="comment">#user_info_obj.usergroup_set.add(*group_objs)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除数据</span></span><br><span class="line"><span class="comment">#user_info_obj.usergroup_set.remove(group_obj)</span></span><br><span class="line"><span class="comment">#user_info_obj.usergroup_set.remove(*group_objs)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取数据</span></span><br><span class="line"><span class="comment">#print group_obj.user_info.all()</span></span><br><span class="line"><span class="comment">#print group_obj.user_info.all().filter(id=1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取数据</span></span><br><span class="line"><span class="comment">#print user_info_obj.usergroup_set.all()</span></span><br><span class="line"><span class="comment">#print user_info_obj.usergroup_set.all().filter(caption='zz')</span></span><br><span class="line"><span class="comment">#print user_info_obj.usergroup_set.all().filter(caption='DBA')</span></span><br></pre></td></tr></table></figure>
<h2 id="分页">分页</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator, EmptyPage, PageNotAnInteger</span><br><span class="line"></span><br><span class="line">L = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">999</span>):</span><br><span class="line">    L.append(i)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    current_page = request.GET.get(<span class="string">'p'</span>)</span><br><span class="line"></span><br><span class="line">    paginator = Paginator(L, <span class="number">10</span>)</span><br><span class="line">    <span class="comment"># per_page: 每页显示条目数量</span></span><br><span class="line">    <span class="comment"># count:    数据总个数</span></span><br><span class="line">    <span class="comment"># num_pages:总页数</span></span><br><span class="line">    <span class="comment"># page_range:总页数的索引范围，如: (1,10),(1,200)</span></span><br><span class="line">    <span class="comment"># page:     page对象</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        posts = paginator.page(current_page)</span><br><span class="line">        <span class="comment"># has_next              是否有下一页</span></span><br><span class="line">        <span class="comment"># next_page_number      下一页页码</span></span><br><span class="line">        <span class="comment"># has_previous          是否有上一页</span></span><br><span class="line">        <span class="comment"># previous_page_number  上一页页码</span></span><br><span class="line">        <span class="comment"># object_list           分页之后的数据列表</span></span><br><span class="line">        <span class="comment"># number                当前页</span></span><br><span class="line">        <span class="comment"># paginator             paginator对象</span></span><br><span class="line">    <span class="keyword">except</span> PageNotAnInteger:</span><br><span class="line">        posts = paginator.page(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span> EmptyPage:</span><br><span class="line">        posts = paginator.page(paginator.num_pages)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, &#123;<span class="string">'posts'</span>: posts&#125;)</span><br><span class="line"></span><br><span class="line">views.py</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head lang=<span class="string">"en"</span>&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &#123;% <span class="keyword">for</span> item <span class="keyword">in</span> posts %&#125;</span><br><span class="line">        &lt;li&gt;&#123;&#123; item &#125;&#125;&lt;/li&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class="pagination"&gt;</span><br><span class="line">      &lt;span class="step-links"&gt;</span><br><span class="line">        &#123;% <span class="keyword">if</span> posts.has_previous %&#125;</span><br><span class="line">            &lt;a href="?p=&#123;&#123; posts.previous_page_number &#125;&#125;"&gt;Previous&lt;/a&gt;</span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">          &lt;span class="current"&gt;</span><br><span class="line">            Page &#123;&#123; posts.number &#125;&#125; of &#123;&#123; posts.paginator.num_pages &#125;&#125;.</span><br><span class="line">          &lt;/span&gt;</span><br><span class="line">          &#123;% <span class="keyword">if</span> posts.has_next %&#125;</span><br><span class="line">              &lt;a href="?p=&#123;&#123; posts.next_page_number &#125;&#125;"&gt;Next&lt;/a&gt;</span><br><span class="line">          &#123;% endif %&#125;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">Html</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator, EmptyPage, PageNotAnInteger</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomPaginator</span><span class="params">(Paginator)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, current_page, max_pager_num, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :param current_page: 当前页</span></span><br><span class="line"><span class="string">        :param max_pager_num:最多显示的页码个数</span></span><br><span class="line"><span class="string">        :param args:</span></span><br><span class="line"><span class="string">        :param kwargs:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.current_page = int(current_page)</span><br><span class="line">        self.max_pager_num = max_pager_num</span><br><span class="line">        super(CustomPaginator, self).__init__(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">page_num_range</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># 当前页面</span></span><br><span class="line">        <span class="comment"># self.current_page</span></span><br><span class="line">        <span class="comment"># 总页数</span></span><br><span class="line">        <span class="comment"># self.num_pages</span></span><br><span class="line">        <span class="comment"># 最多显示的页码个数</span></span><br><span class="line">        <span class="comment"># self.max_pager_num</span></span><br><span class="line">        print(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> self.num_pages &lt; self.max_pager_num:</span><br><span class="line">            <span class="keyword">return</span> range(<span class="number">1</span>, self.num_pages + <span class="number">1</span>)</span><br><span class="line">        print(<span class="number">2</span>)</span><br><span class="line">        part = int(self.max_pager_num / <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> self.current_page - part &lt; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> range(<span class="number">1</span>, self.max_pager_num + <span class="number">1</span>)</span><br><span class="line">        print(<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">if</span> self.current_page + part &gt; self.num_pages:</span><br><span class="line">            <span class="keyword">return</span> range(self.num_pages + <span class="number">1</span> - self.max_pager_num, self.num_pages + <span class="number">1</span>)</span><br><span class="line">        print(<span class="number">4</span>)</span><br><span class="line">        <span class="keyword">return</span> range(self.current_page - part, self.current_page + part + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">L = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">999</span>):</span><br><span class="line">    L.append(i)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    current_page = request.GET.get(<span class="string">'p'</span>)</span><br><span class="line">    paginator = CustomPaginator(current_page, <span class="number">11</span>, L, <span class="number">10</span>)</span><br><span class="line">    <span class="comment"># per_page: 每页显示条目数量</span></span><br><span class="line">    <span class="comment"># count:    数据总个数</span></span><br><span class="line">    <span class="comment"># num_pages:总页数</span></span><br><span class="line">    <span class="comment"># page_range:总页数的索引范围，如: (1,10),(1,200)</span></span><br><span class="line">    <span class="comment"># page:     page对象</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        posts = paginator.page(current_page)</span><br><span class="line">        <span class="comment"># has_next              是否有下一页</span></span><br><span class="line">        <span class="comment"># next_page_number      下一页页码</span></span><br><span class="line">        <span class="comment"># has_previous          是否有上一页</span></span><br><span class="line">        <span class="comment"># previous_page_number  上一页页码</span></span><br><span class="line">        <span class="comment"># object_list           分页之后的数据列表</span></span><br><span class="line">        <span class="comment"># number                当前页</span></span><br><span class="line">        <span class="comment"># paginator             paginator对象</span></span><br><span class="line">    <span class="keyword">except</span> PageNotAnInteger:</span><br><span class="line">        posts = paginator.page(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span> EmptyPage:</span><br><span class="line">        posts = paginator.page(paginator.num_pages)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, &#123;<span class="string">'posts'</span>: posts&#125;)</span><br><span class="line"></span><br><span class="line">扩展内置分页：views.py</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head lang=<span class="string">"en"</span>&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &#123;% <span class="keyword">for</span> item <span class="keyword">in</span> posts %&#125;</span><br><span class="line">        &lt;li&gt;&#123;&#123; item &#125;&#125;&lt;/li&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class="pagination"&gt;</span><br><span class="line">&lt;span class="step-links"&gt;</span><br><span class="line">&#123;% <span class="keyword">if</span> posts.has_previous %&#125;</span><br><span class="line">    &lt;a href="?p=&#123;&#123; posts.previous_page_number &#125;&#125;"&gt;Previous&lt;/a&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">    &#123;% <span class="keyword">for</span> i <span class="keyword">in</span> posts.paginator.page_num_range %&#125;</span><br><span class="line">        &lt;a href="?p=&#123;&#123; i &#125;&#125;"&gt;&#123;&#123; i &#125;&#125;&lt;/a&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">    &#123;% <span class="keyword">if</span> posts.has_next %&#125;</span><br><span class="line">        &lt;a href="?p=&#123;&#123; posts.next_page_number &#125;&#125;"&gt;Next&lt;/a&gt;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">&lt;span class="current"&gt;</span><br><span class="line">Page &#123;&#123; posts.number &#125;&#125; of &#123;&#123; posts.paginator.num_pages &#125;&#125;.</span><br><span class="line">&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">扩展内置分页：Html</span><br></pre></td></tr></table></figure>
<h3 id="自定义分页">自定义分页</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># _*_coding:utf-8_*_</span></span><br><span class="line"><span class="keyword">from</span> django.utils.safestring <span class="keyword">import</span> mark_safe</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PageInfo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,current,totalItem,peritems=<span class="number">5</span>)</span>:</span></span><br><span class="line">        self.__current=current</span><br><span class="line">        self.__peritems=peritems</span><br><span class="line">        self.__totalItem=totalItem</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">From</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (self.__current<span class="number">-1</span>)*self.__peritems</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">To</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__current*self.__peritems</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">TotalPage</span><span class="params">(self)</span>:</span>  <span class="comment">#总页数</span></span><br><span class="line">        result=divmod(self.__totalItem,self.__peritems)</span><br><span class="line">        <span class="keyword">if</span> result[<span class="number">1</span>]==<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> result[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> result[<span class="number">0</span>]+<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Custompager</span><span class="params">(baseurl,currentPage,totalpage)</span>:</span>  <span class="comment">#基础页，当前页，总页数</span></span><br><span class="line">    perPager=<span class="number">11</span></span><br><span class="line">    <span class="comment">#总页数&lt;11</span></span><br><span class="line">    <span class="comment">#0 -- totalpage</span></span><br><span class="line">    <span class="comment">#总页数&gt;11</span></span><br><span class="line">        <span class="comment">#当前页大于5 currentPage-5 -- currentPage+5</span></span><br><span class="line">            <span class="comment">#currentPage+5是否超过总页数,超过总页数，end就是总页数</span></span><br><span class="line">        <span class="comment">#当前页小于5 0 -- 11</span></span><br><span class="line">    begin=<span class="number">0</span></span><br><span class="line">    end=<span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> totalpage &lt;= <span class="number">11</span>:</span><br><span class="line">        begin=<span class="number">0</span></span><br><span class="line">        end=totalpage</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> currentPage&gt;<span class="number">5</span>:</span><br><span class="line">            begin=currentPage<span class="number">-5</span></span><br><span class="line">            end=currentPage+<span class="number">5</span></span><br><span class="line">            <span class="keyword">if</span> end &gt; totalpage:</span><br><span class="line">                end=totalpage</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            begin=<span class="number">0</span></span><br><span class="line">            end=<span class="number">11</span></span><br><span class="line">    pager_list=[]</span><br><span class="line">    <span class="keyword">if</span> currentPage&lt;=<span class="number">1</span>:</span><br><span class="line">        first=<span class="string">"&lt;a href=''&gt;首页&lt;/a&gt;"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        first=<span class="string">"&lt;a href='%s%d'&gt;首页&lt;/a&gt;"</span> % (baseurl,<span class="number">1</span>)</span><br><span class="line">    pager_list.append(first)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> currentPage&lt;=<span class="number">1</span>:</span><br><span class="line">        prev=<span class="string">"&lt;a href=''&gt;上一页&lt;/a&gt;"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        prev=<span class="string">"&lt;a href='%s%d'&gt;上一页&lt;/a&gt;"</span> % (baseurl,currentPage<span class="number">-1</span>)</span><br><span class="line">    pager_list.append(prev)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(begin+<span class="number">1</span>,end+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> i == currentPage:</span><br><span class="line">            temp=<span class="string">"&lt;a href='%s%d' class='selected'&gt;%d&lt;/a&gt;"</span> % (baseurl,i,i)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            temp=<span class="string">"&lt;a href='%s%d'&gt;%d&lt;/a&gt;"</span> % (baseurl,i,i)</span><br><span class="line">        pager_list.append(temp)</span><br><span class="line">    <span class="keyword">if</span> currentPage&gt;=totalpage:</span><br><span class="line">        next=<span class="string">"&lt;a href='#'&gt;下一页&lt;/a&gt;"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        next=<span class="string">"&lt;a href='%s%d'&gt;下一页&lt;/a&gt;"</span> % (baseurl,currentPage+<span class="number">1</span>)</span><br><span class="line">    pager_list.append(next)</span><br><span class="line">    <span class="keyword">if</span> currentPage&gt;=totalpage:</span><br><span class="line">        last=<span class="string">"&lt;a href=''&gt;末页&lt;/a&gt;"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        last=<span class="string">"&lt;a href='%s%d'&gt;末页&lt;/a&gt;"</span> % (baseurl,totalpage)</span><br><span class="line">    pager_list.append(last)</span><br><span class="line">    result=<span class="string">''</span>.join(pager_list)</span><br><span class="line">    <span class="keyword">return</span> mark_safe(result)   <span class="comment">#把字符串转成html语言</span></span><br><span class="line"></span><br><span class="line">分页实例</span><br></pre></td></tr></table></figure>
<h2 id="缓存">缓存</h2>
<h3 id="配置">配置</h3>
<ol>
<li>开发调试</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 此为开始调试用，实际内部不做任何操作</span></span><br><span class="line">    <span class="comment"># 配置：</span></span><br><span class="line">        CACHES = &#123;</span><br><span class="line">            <span class="string">'default'</span>: &#123;</span><br><span class="line">                <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.dummy.DummyCache'</span>,     <span class="comment"># 引擎</span></span><br><span class="line">                <span class="string">'TIMEOUT'</span>: <span class="number">300</span>,                                               <span class="comment"># 缓存超时时间（默认300，None表示永不过期，0表示立即过期）</span></span><br><span class="line">                <span class="string">'OPTIONS'</span>:&#123;</span><br><span class="line">                    <span class="string">'MAX_ENTRIES'</span>: <span class="number">300</span>,                                       <span class="comment"># 最大缓存个数（默认300）</span></span><br><span class="line">                    <span class="string">'CULL_FREQUENCY'</span>: <span class="number">3</span>,                                      <span class="comment"># 缓存到达最大个数之后，剔除缓存个数的比例，即：1/CULL_FREQUENCY（默认3）</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">'KEY_PREFIX'</span>: <span class="string">''</span>,                                             <span class="comment"># 缓存key的前缀（默认空）</span></span><br><span class="line">                <span class="string">'VERSION'</span>: <span class="number">1</span>,                                                 <span class="comment"># 缓存key的版本（默认1）</span></span><br><span class="line">                <span class="string">'KEY_FUNCTION'</span> 函数名                                          <span class="comment"># 生成key的函数（默认函数会生成为：【前缀:版本:key】）</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 自定义key</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">default_key_func</span><span class="params">(key, key_prefix, version)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Default function to generate keys.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Constructs the key used by all other methods. By default it prepends</span></span><br><span class="line"><span class="string">        the `key_prefix'. KEY_FUNCTION can be used to specify an alternate</span></span><br><span class="line"><span class="string">        function with custom key making behavior.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'%s:%s:%s'</span> % (key_prefix, version, key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_key_func</span><span class="params">(key_func)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Function to decide which key function to use.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Defaults to ``default_key_func``.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> key_func <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">if</span> callable(key_func):</span><br><span class="line">                <span class="keyword">return</span> key_func</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> import_string(key_func)</span><br><span class="line">        <span class="keyword">return</span> default_key_func</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>内存</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 此缓存将内容保存至内存的变量中</span></span><br><span class="line">    <span class="comment"># 配置：</span></span><br><span class="line">        CACHES = &#123;</span><br><span class="line">            <span class="string">'default'</span>: &#123;</span><br><span class="line">                <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.locmem.LocMemCache'</span>,</span><br><span class="line">                <span class="string">'LOCATION'</span>: <span class="string">'unique-snowflake'</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 注：其他配置同开发调试版本</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>文件</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 此缓存将内容保存至文件</span></span><br><span class="line">    <span class="comment"># 配置：</span></span><br><span class="line"></span><br><span class="line">        CACHES = &#123;</span><br><span class="line">            <span class="string">'default'</span>: &#123;</span><br><span class="line">                <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.filebased.FileBasedCache'</span>,</span><br><span class="line">                <span class="string">'LOCATION'</span>: <span class="string">'/var/tmp/django_cache'</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment"># 注：其他配置同开发调试版本</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>数据库</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 此缓存将内容保存至数据库</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 配置：</span></span><br><span class="line">        CACHES = &#123;</span><br><span class="line">            <span class="string">'default'</span>: &#123;</span><br><span class="line">                <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.db.DatabaseCache'</span>,</span><br><span class="line">                <span class="string">'LOCATION'</span>: <span class="string">'my_cache_table'</span>, <span class="comment"># 数据库表</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 注：执行创建表命令 python manage.py createcachetable</span></span><br></pre></td></tr></table></figure>
<ol start="5">
<li>Memcache缓存（python-memcached模块）</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 此缓存使用python-memcached模块连接memcache</span></span><br><span class="line"></span><br><span class="line">    CACHES = &#123;</span><br><span class="line">        <span class="string">'default'</span>: &#123;</span><br><span class="line">            <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.MemcachedCache'</span>,</span><br><span class="line">            <span class="string">'LOCATION'</span>: <span class="string">'127.0.0.1:11211'</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    CACHES = &#123;</span><br><span class="line">        <span class="string">'default'</span>: &#123;</span><br><span class="line">            <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.MemcachedCache'</span>,</span><br><span class="line">            <span class="string">'LOCATION'</span>: <span class="string">'unix:/tmp/memcached.sock'</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    CACHES = &#123;</span><br><span class="line">        <span class="string">'default'</span>: &#123;</span><br><span class="line">            <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.MemcachedCache'</span>,</span><br><span class="line">            <span class="string">'LOCATION'</span>: [</span><br><span class="line">                <span class="string">'172.19.26.240:11211'</span>,</span><br><span class="line">                <span class="string">'172.19.26.242:11211'</span>,</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>Memcache缓存（pylibmc模块）</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 此缓存使用pylibmc模块连接memcache</span></span><br><span class="line"></span><br><span class="line">    CACHES = &#123;</span><br><span class="line">        <span class="string">'default'</span>: &#123;</span><br><span class="line">            <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.PyLibMCCache'</span>,</span><br><span class="line">            <span class="string">'LOCATION'</span>: <span class="string">'127.0.0.1:11211'</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    CACHES = &#123;</span><br><span class="line">        <span class="string">'default'</span>: &#123;</span><br><span class="line">            <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.PyLibMCCache'</span>,</span><br><span class="line">            <span class="string">'LOCATION'</span>: <span class="string">'/tmp/memcached.sock'</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    CACHES = &#123;</span><br><span class="line">        <span class="string">'default'</span>: &#123;</span><br><span class="line">            <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.PyLibMCCache'</span>,</span><br><span class="line">            <span class="string">'LOCATION'</span>: [</span><br><span class="line">                <span class="string">'172.19.26.240:11211'</span>,</span><br><span class="line">                <span class="string">'172.19.26.242:11211'</span>,</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ol start="7">
<li>Redis缓存（依赖：pip3 install django-redis）</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">"default"</span>: &#123;</span><br><span class="line">        <span class="string">"BACKEND"</span>: <span class="string">"django_redis.cache.RedisCache"</span>,</span><br><span class="line">        <span class="string">"LOCATION"</span>: <span class="string">"redis://127.0.0.1:6379"</span>,</span><br><span class="line">        <span class="string">"OPTIONS"</span>: &#123;</span><br><span class="line">            <span class="string">"CLIENT_CLASS"</span>: <span class="string">"django_redis.client.DefaultClient"</span>,</span><br><span class="line">            <span class="string">"CONNECTION_POOL_KWARGS"</span>: &#123;<span class="string">"max_connections"</span>: <span class="number">100</span>&#125;</span><br><span class="line">            <span class="comment"># "PASSWORD": "密码",</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>视图中链接并操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django_redis <span class="keyword">import</span> get_redis_connection</span><br><span class="line">conn = get_redis_connection(<span class="string">"default"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="应用">应用</h3>
<ol>
<li>全站使用</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">使用中间件，经过一系列的认证等操作，如果内容在缓存中存在，则使用FetchFromCacheMiddleware获取内容并返回给用户，当返回给用户之前，判断缓存中是否已经存在，如果不存在则UpdateCacheMiddleware会将缓存保存至缓存，从而实现全站缓存</span><br><span class="line"></span><br><span class="line">    MIDDLEWARE = [</span><br><span class="line">        <span class="string">'django.middleware.cache.UpdateCacheMiddleware'</span>,</span><br><span class="line">        <span class="comment"># 其他中间件...</span></span><br><span class="line">        <span class="string">'django.middleware.cache.FetchFromCacheMiddleware'</span>,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    CACHE_MIDDLEWARE_ALIAS = <span class="string">""</span></span><br><span class="line">    CACHE_MIDDLEWARE_SECONDS = <span class="string">""</span></span><br><span class="line">    CACHE_MIDDLEWARE_KEY_PREFIX = <span class="string">""</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>单独视图缓存</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">方式一：</span><br><span class="line">        <span class="keyword">from</span> django.views.decorators.cache <span class="keyword">import</span> cache_page</span><br><span class="line"></span><br><span class="line"><span class="meta">        @cache_page(60 * 15)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">my_view</span><span class="params">(request)</span>:</span></span><br><span class="line">            ...</span><br><span class="line"></span><br><span class="line">    方式二：</span><br><span class="line">        <span class="keyword">from</span> django.views.decorators.cache <span class="keyword">import</span> cache_page</span><br><span class="line"></span><br><span class="line">        urlpatterns = [</span><br><span class="line">            url(<span class="string">r'^foo/([0-9]&#123;1,2&#125;)/$'</span>, cache_page(<span class="number">60</span> * <span class="number">15</span>)(my_view)),</span><br><span class="line">        ]</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>局部视图使用</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a. 引入TemplateTag</span><br><span class="line"></span><br><span class="line">        &#123;% load cache %&#125;</span><br><span class="line"></span><br><span class="line">    b. 使用缓存</span><br><span class="line"></span><br><span class="line">        &#123;% cache <span class="number">5000</span> 缓存key %&#125;</span><br><span class="line">            缓存内容</span><br><span class="line">        &#123;% endcache %&#125;</span><br></pre></td></tr></table></figure>
<h2 id="信号">信号</h2>
<p>Django中提供了“信号调度”，用于在框架执行操作时解耦。通俗来讲，就是一些动作发生的时候，信号允许特定的发送者去提醒一些接受者。</p>
<h3 id="django内置信号">Django内置信号</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Model signals</span><br><span class="line">    pre_init                    <span class="comment"># django的modal执行其构造方法前，自动触发</span></span><br><span class="line">    post_init                   <span class="comment"># django的modal执行其构造方法后，自动触发</span></span><br><span class="line">    pre_save                    <span class="comment"># django的modal对象保存前，自动触发</span></span><br><span class="line">    post_save                   <span class="comment"># django的modal对象保存后，自动触发</span></span><br><span class="line">    pre_delete                  <span class="comment"># django的modal对象删除前，自动触发</span></span><br><span class="line">    post_delete                 <span class="comment"># django的modal对象删除后，自动触发</span></span><br><span class="line">    m2m_changed                 <span class="comment"># django的modal中使用m2m字段操作第三张表（add,remove,clear）前后，自动触发</span></span><br><span class="line">    class_prepared              <span class="comment"># 程序启动时，检测已注册的app中modal类，对于每一个类，自动触发</span></span><br><span class="line">Management signals</span><br><span class="line">    pre_migrate                 <span class="comment"># 执行migrate命令前，自动触发</span></span><br><span class="line">    post_migrate                <span class="comment"># 执行migrate命令后，自动触发</span></span><br><span class="line">Request/response signals</span><br><span class="line">    request_started             <span class="comment"># 请求到来前，自动触发</span></span><br><span class="line">    request_finished            <span class="comment"># 请求结束后，自动触发</span></span><br><span class="line">    got_request_exception       <span class="comment"># 请求异常后，自动触发</span></span><br><span class="line">Test signals</span><br><span class="line">    setting_changed             <span class="comment"># 使用test测试修改配置文件时，自动触发</span></span><br><span class="line">    template_rendered           <span class="comment"># 使用test测试渲染模板时，自动触发</span></span><br><span class="line">Database Wrappers</span><br><span class="line">    connection_created          <span class="comment"># 创建数据库连接时，自动触发</span></span><br></pre></td></tr></table></figure>
<p>对于Django内置的信号，仅需注册指定信号，当程序执行相应操作时，自动触发注册函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.signals <span class="keyword">import</span> request_finished</span><br><span class="line">    <span class="keyword">from</span> django.core.signals <span class="keyword">import</span> request_started</span><br><span class="line">    <span class="keyword">from</span> django.core.signals <span class="keyword">import</span> got_request_exception</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> django.db.models.signals <span class="keyword">import</span> class_prepared</span><br><span class="line">    <span class="keyword">from</span> django.db.models.signals <span class="keyword">import</span> pre_init, post_init</span><br><span class="line">    <span class="keyword">from</span> django.db.models.signals <span class="keyword">import</span> pre_save, post_save</span><br><span class="line">    <span class="keyword">from</span> django.db.models.signals <span class="keyword">import</span> pre_delete, post_delete</span><br><span class="line">    <span class="keyword">from</span> django.db.models.signals <span class="keyword">import</span> m2m_changed</span><br><span class="line">    <span class="keyword">from</span> django.db.models.signals <span class="keyword">import</span> pre_migrate, post_migrate</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> django.test.signals <span class="keyword">import</span> setting_changed</span><br><span class="line">    <span class="keyword">from</span> django.test.signals <span class="keyword">import</span> template_rendered</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> django.db.backends.signals <span class="keyword">import</span> connection_created</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(sender, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">"xxoo_callback"</span>)</span><br><span class="line">        print(sender,kwargs)</span><br><span class="line"></span><br><span class="line">    xxoo.connect(callback)</span><br><span class="line">    <span class="comment"># xxoo指上述导入的内容</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.signals <span class="keyword">import</span> request_finished</span><br><span class="line"><span class="keyword">from</span> django.dispatch <span class="keyword">import</span> receiver</span><br><span class="line"></span><br><span class="line"><span class="meta">@receiver(request_finished)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_callback</span><span class="params">(sender, **kwargs)</span>:</span></span><br><span class="line">    print(<span class="string">"Request finished!"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="自定义信号">自定义信号</h3>
<ol>
<li>定义信号</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> django.dispatch</span><br><span class="line">pizza_done = django.dispatch.Signal(providing_args=[<span class="string">"toppings"</span>, <span class="string">"size"</span>])</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>注册信号</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">callback</span><span class="params">(sender, **kwargs)</span>:</span></span><br><span class="line">    print(<span class="string">"callback"</span>)</span><br><span class="line">    print(sender,kwargs)</span><br><span class="line"></span><br><span class="line">pizza_done.connect(callback)</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>触发信号</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> 路径 <span class="keyword">import</span> pizza_done</span><br><span class="line"></span><br><span class="line">pizza_done.send(sender=<span class="string">'seven'</span>,toppings=<span class="number">123</span>, size=<span class="number">456</span>)</span><br></pre></td></tr></table></figure>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/article/websecurity/" data-toggle="tooltip" data-placement="top" title="web安全">&larr; Previous Post</a>
                        </li>
                    
                    
                </ul>

                <br>
                
                <!-- require APlayer -->
                

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->

                

            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

  
    <style>
      span.toc-nav-number{
        display: none
      }
    </style>
  
    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#django-开始"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">Django &#x5F00;&#x59CB;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#django的mtv分别代表"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">Django&#x7684;MTV&#x5206;&#x522B;&#x4EE3;&#x8868;&#xFF1A;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#启动django项目"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text">&#x542F;&#x52A8;Django&#x9879;&#x76EE;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#建表命令"><span class="toc-nav-number">1.3.</span> <span class="toc-nav-text">&#x5EFA;&#x8868;&#x547D;&#x4EE4;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#路由系统"><span class="toc-nav-number">1.4.</span> <span class="toc-nav-text">&#x8DEF;&#x7531;&#x7CFB;&#x7EDF;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#路由分发"><span class="toc-nav-number">1.5.</span> <span class="toc-nav-text">&#x8DEF;&#x7531;&#x5206;&#x53D1;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#反向生成url"><span class="toc-nav-number">1.6.</span> <span class="toc-nav-text">&#x53CD;&#x5411;&#x751F;&#x6210;url</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#模版语言"><span class="toc-nav-number">1.7.</span> <span class="toc-nav-text">&#x6A21;&#x7248;&#x8BED;&#x8A00;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#simple_tag"><span class="toc-nav-number">1.8.</span> <span class="toc-nav-text">simple_tag</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#中间件"><span class="toc-nav-number">1.9.</span> <span class="toc-nav-text">&#x4E2D;&#x95F4;&#x4EF6;</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#admin"><span class="toc-nav-number">1.10.</span> <span class="toc-nav-text">admin</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#form"><span class="toc-nav-number">1.11.</span> <span class="toc-nav-text">Form</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#modelform"><span class="toc-nav-number">1.11.1.</span> <span class="toc-nav-text">ModelForm</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#orm数据库操作"><span class="toc-nav-number">1.12.</span> <span class="toc-nav-text">ORM&#x6570;&#x636E;&#x5E93;&#x64CD;&#x4F5C;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#字段"><span class="toc-nav-number">1.12.1.</span> <span class="toc-nav-text">&#x5B57;&#x6BB5;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#参数"><span class="toc-nav-number">1.12.2.</span> <span class="toc-nav-text">&#x53C2;&#x6570;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#其他"><span class="toc-nav-number">1.12.3.</span> <span class="toc-nav-text">&#x5176;&#x4ED6;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#扩展"><span class="toc-nav-number">1.12.4.</span> <span class="toc-nav-text">&#x6269;&#x5C55;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#表结构"><span class="toc-nav-number">1.12.5.</span> <span class="toc-nav-text">&#x8868;&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#基本操作"><span class="toc-nav-number">1.12.6.</span> <span class="toc-nav-text">&#x57FA;&#x672C;&#x64CD;&#x4F5C;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#进阶操作"><span class="toc-nav-number">1.12.7.</span> <span class="toc-nav-text">&#x8FDB;&#x9636;&#x64CD;&#x4F5C;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#其他操作"><span class="toc-nav-number">1.12.8.</span> <span class="toc-nav-text">&#x5176;&#x4ED6;&#x64CD;&#x4F5C;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#连表操作"><span class="toc-nav-number">1.12.9.</span> <span class="toc-nav-text">&#x8FDE;&#x8868;&#x64CD;&#x4F5C;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#一对一"><span class="toc-nav-number">1.12.10.</span> <span class="toc-nav-text">&#x4E00;&#x5BF9;&#x4E00;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#一对多"><span class="toc-nav-number">1.12.11.</span> <span class="toc-nav-text">&#x4E00;&#x5BF9;&#x591A;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#多对多"><span class="toc-nav-number">1.12.12.</span> <span class="toc-nav-text">&#x591A;&#x5BF9;&#x591A;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#分页"><span class="toc-nav-number">1.13.</span> <span class="toc-nav-text">&#x5206;&#x9875;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#自定义分页"><span class="toc-nav-number">1.13.1.</span> <span class="toc-nav-text">&#x81EA;&#x5B9A;&#x4E49;&#x5206;&#x9875;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#缓存"><span class="toc-nav-number">1.14.</span> <span class="toc-nav-text">&#x7F13;&#x5B58;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#配置"><span class="toc-nav-number">1.14.1.</span> <span class="toc-nav-text">&#x914D;&#x7F6E;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#应用"><span class="toc-nav-number">1.14.2.</span> <span class="toc-nav-text">&#x5E94;&#x7528;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#信号"><span class="toc-nav-number">1.15.</span> <span class="toc-nav-text">&#x4FE1;&#x53F7;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#django内置信号"><span class="toc-nav-number">1.15.1.</span> <span class="toc-nav-text">Django&#x5185;&#x7F6E;&#x4FE1;&#x53F7;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#自定义信号"><span class="toc-nav-number">1.15.2.</span> <span class="toc-nav-text">&#x81EA;&#x5B9A;&#x4E49;&#x4FE1;&#x53F7;</span></a></li></ol></li></ol></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">标签列表</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#django" title="django">django</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
            </div>
        </div>
    </div>
</article>








<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/MrLiuGer">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; MrLiu 2018 
                    <br>
                    <!-- Theme by <a href="http://beantech.org">BeanTech</a> --> 
                    re-Ported by <a href="https://github.com/MrLiuGer">MrLiu</a>
					<span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://mrliuger.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = 'r45fhy7653897235wg5ye709d930f62e';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="https://mrliuger.github.io/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
